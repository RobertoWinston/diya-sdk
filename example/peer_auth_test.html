<script type="text/javascript" src="../build/diya-sdk.js"></script>
<script>

function ERR(e) { document.getElementById("err").innerHTML += "<li>"+ e + "</li>";}

try {
	d1.connect("ws://localhost:40001").then(function(){

		ERR("Connected !");

		d1(/.*/).each(function(peer){
			ERR("- " + peer);
		});

	});
} catch(e) {
	ERR(e);
}

function doJoin(){
		ERR("B -> A ...");
		d1("B").auth("admin", "pass", function(peerId, bAuthenticated) {
				if(!bAuthenticated) ERR("ACCESS DENIED BY PEER " +  peerId);
				else  {
					ERR("SUCCESSFULLY LOGGED IN TO B");
					d1("B").join("A", true, function() {
						ERR("YOUPI !!!!");
					});
				}
	});
}


function doCheck() {
	ERR("Check if A trust B");
	d1("A").auth("admin", "pass", function(peerId, bAuthenticated) {
			if(!bAuthenticated) ERR("ACCESS DENIED BY PEER " +  peerId);
			else  {
				ERR("SUCCESSFULLY LOGGED IN TO A");
				d1(/.*/).areTrusted("B", function(peerId, err, data) {
					if(err) ERR("ERROR : " + err);
					else ERR(data);
				});
			}
		});
}

</script>

<input type="button" onclick="doJoin()" value="JOIN !"/>
<input type="button" onclick="doCheck()" value="Check !"/>

<ul id="err" style="font-size:20px;color:red"></ul>
<style> ul > li { margin-top: 20px;}</style>
